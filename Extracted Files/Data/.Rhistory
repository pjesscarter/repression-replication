#Registration
fnl_ps_reg <- fnl_ps %>% filter(!is.na(Share_reg70_w2)) %>% mutate(D = DMilitaryPresence ==1)
#1:1 matching with replacement, using pop weights - authors do not specify estimand but
#can infer that it is the ATE
matched <- Match(Y=fnl_ps_reg$Share_reg70_w2,
Tr=fnl_ps_reg$D,
X=fnl_ps_reg$propscore,
M=1,
weights = fnl_ps_reg$Pop70,
estimand = "ATE",
caliper = 0.2) #optimal caliper per Austin 2011
summary(matched)
library(pacman)
p_load(haven,stringr,dplyr,ggplot2,mediation)
setwd("../../Extracted Files/Data")
toload <- str_subset(list.files(),".dta")
data <- lapply(toload, read_dta)
gc()
p_load(haven,stringr,dplyr,ggplot2,mediation)
setwd("../../Extracted Files/Data")
toload <- str_subset(list.files(),".dta")
data <- lapply(toload, read_dta)
fnl <- data[[1]]
set.seed(08540)
?mediate
c(1,NULL)
makeform <- function(outcome,mediation){
#Edit to change baseline controls
if(mediation){
m <- "shVictims_70"
} else{m <- NULL}
controls <- c(m,"share_allende70",
"share_alessandri70",
"lnDistStgo",
"lnDistRegCapital",
"Pop70_pthousands",
"sh_rural_70")
f <- as.formula(
paste(paste(outcome,
paste(c("DMilitaryPresence",controls), collapse = " + "),
sep = " ~ "), "| year+ IDProv | 0 | longitud + latitud",sep=" "))
}
outcome <- "VoteShareNO"
m1 <- fnl %>% filter(MainSample==1) %>% lm(makeform(outcome,F),data=.,weights = Pop70)
outcome <- "VoteShareNo"
m1 <- fnl %>% filter(MainSample==1) %>% lm(makeform(outcome,F),data=.,weights = Pop70)
makeform <- function(outcome,mediation){
#Edit to change baseline controls
if(mediation){
m <- "shVictims_70"
} else{m <- NULL}
controls <- c(m,"share_allende70",
"share_alessandri70",
"lnDistStgo",
"lnDistRegCapital",
"Pop70_pthousands",
"sh_rural_70")
f <- as.formula((paste(outcome,
paste(c("DMilitaryPresence",controls), collapse = " + "),
sep = " ~ ")))
}
m1 <- fnl %>% filter(MainSample==1) %>% lm(makeform(outcome,F),data=.,weights = Pop70)
summary(m1)
clust <- fnl %>% filter(MainSample==1) %>% select(IDProv)
clust <- fnl %>% filter(MainSample==1) %>% dplyr::select(IDProv) %>% as.vector %>% as.numeric()
clust <- fnl %>% filter(MainSample==1) %>% dplyr::select(IDProv) %>% as.vector
clust <- fnl %>% filter(MainSample==1) %>% dplyr::select(IDProv) %>% as.vector()
clust <- (fnl %>% filter(MainSample==1))IDProv
clust <- (fnl %>% filter(MainSample==1))$IDProv
clust <- (fnl %>% filter(MainSample==1))$IDProv
m1 <- fnl %>% filter(MainSample==1) %>% lm(makeform("shVictims_70",F),data=.,weights = Pop70)
m2 <- fnl %>% filter(MainSample==1) %>% lm(makeform(outcome,T),data=.,weights = Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000,cluster = clust)
m1$model
m1$model %>% dim()
m2$model %>% dim()
summary(m1)
summary(m2)
install.packages(mediation)
install.packages("mediation")
install.packages("mediation")
unloadNamespace(mediation)
unloadNamespace("mediation")
install.packages("mediation")
library(mediation)
m1 <- fnl %>% filter(MainSample==1) %>% lm(makeform("shVictims_70",F),data=.,weights = Pop70)
m2 <- fnl %>% filter(MainSample==1) %>% lm(makeform(outcome,T),data=.,weights = Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
m1 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome)) %>% lm(makeform("shVictims_70",F),data=.,weights = Pop70)
m1 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome)) %>% lm(makeform("shVictims_70",F),data=.,weights = Pop70)
m2 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome)) %>% lm(makeform(outcome,T),data=.,weights = Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
m1 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome)) %>% lm(makeform("shVictims_70",F),data=.,weights = .$Pop70)
m1 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% lm(makeform("shVictims_70",F),data=.,weights = Pop70)
m2 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% lm(makeform(outcome,T),data=.,weights = Pop70)
summary(m1)
summary(m2)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
m1 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% lm(makeform("shVictims_70",F),data=.,weights = Pop70)
m2 <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% lm(makeform(outcome,T),data=.,weights = Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70))
m1 <-  lm(makeform("shVictims_70",F),data=dat,weights = dat$Pop70)
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70))
m1 <-  lm(makeform("shVictims_70",F),data=dat,weights = dat$Pop70)
m2 <-  lm(makeform(outcome,T),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70))
m1 <-  lm(makeform("shVictims_70",F),data=dat)
m2 <-  lm(makeform(outcome,T),data=dat)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100,weights)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
m1$model %>% dim()
m2$model %>% dim()
m1 <-  lm(shVictims ~ DMilitaryPresence,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims,data=dat,weights = dat$Pop70)
m1 <-  lm(shVictims_70 ~ DMilitaryPresence,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
summary(m)
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70 + IDProv,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70 + IDProv,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
summary(m)
makeform <- function(outcome,mediation){
#Edit to change baseline controls
if(mediation){
controls <- c("shVictims_70","share_allende70",
"share_alessandri70",
"lnDistStgo",
"lnDistRegCapital",
"Pop70_pthousands",
"sh_rural_70","IDProv")
} else{
controls <- c("share_allende70",
"share_alessandri70",
"lnDistStgo",
"lnDistRegCapital",
"Pop70_pthousands",
"sh_rural_70","IDProv")
}
f <- as.formula((paste(outcome,
paste(c("DMilitaryPresence",controls), collapse = " + "),
sep = " ~ ")))
}
m1 <-  lm(makeform("shVictims_70",F),data=dat)
m2 <-  lm(makeform(outcome,T),data=dat)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=100)
m1$terms
m11 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m11$terms
m11$call
m1$call
mediate <- function(outcome){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
}
outcomes <- c("VoteShareNo",
"Share_reg70_w2",
"share_aylwin89",
"share_frei93",
"share_lagos99",
"share_bachelet05",
"share_frei09")
mediateout <- function(outcome){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
}
if(!require(pacman)){
install.packages("pacman")
library(pacman)
}
p_load(haven,stringr,dplyr,ggplot2,mediation)
setwd("../../Extracted Files/Data")
toload <- str_subset(list.files(),".dta")
data <- lapply(toload, read_dta)
fnl <- data[[1]]
set.seed(08540)
mediateout <- function(outcome){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
}
outcomes <- c("VoteShareNo",
"Share_reg70_w2",
"share_aylwin89",
"share_frei93",
"share_lagos99",
"share_bachelet05",
"share_frei09")
medmods <- list()
for(i in seq_along(medmods)){
medmos[[i]]<-mediateout(outcomes[i])
}
lapply(medmods,function(x){print(summary(x))})
for(i in seq_along(medmods)){
medmods[[i]]<-mediateout(outcomes[i])
}
mediateout <- function(outcome){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(VoteShareNo ~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
outcomes <- c("VoteShareNo",
"Share_reg70_w2",
"share_aylwin89",
"share_frei93",
"share_lagos99",
"share_bachelet05",
"share_frei09")
medmods <- list()
for(i in seq_along(medmods)){
medmods[[i]]<-mediateout(outcomes[i])
}
mediateout(outcomes[1])
as.formula("y ~ x")
paste("a","b")
paste("a","b",sep="")
mediateout <- function(outcome){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(outcome),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(as.formula(paste(outcome, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70")),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
mediateout <- function(outcome){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(as.formula(paste(outcome, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70")),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
test <- function(outcome){paste(outcome, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70")}
test("VoteShareNo")
mediateout <- function(out){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(as.formula(paste(out, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70")),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
mediateout <- function(out){
outcome <- out
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(as.formula(paste(outcome, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70")),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
mediateout(out = "VoteShareNo")
mediateout <- function(out){
outform <- as.formula(paste(out, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"))
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
outform <- as.formula(paste("VoteShareNo", "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"))
outform
outform <- as.formula(paste(x, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"))
mediateout <- function(x){
outform <- as.formula(paste(x, "~ DMilitaryPresence + shVictims_70 + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"))
print(outform)
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
m1 <-  lm(shVictims_70 ~ DMilitaryPresence + IDProv + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
paste0("IDProv",2:length(levels(fnl$IDProv))
)
paste0("IDProv",2:length(levels(fnl$IDProv),sep=" + ")
)
paste0("IDProv",2:length(levels(fnl$IDProv),collapse=" + ")
)
paste0("IDProv",2:length(levels(fnl$IDProv)),sep = " + ")
paste0("IDProv",2:length(levels(fnl$IDProv)),collapse = " + ")
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
outform <- as.formula(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"))
x <- "VoteShareNo"
outform <- as.formula(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"))
outform
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform
outform <- as.formula(paste(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
outform
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
outform <- as.formula(paste(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
warnings()
summary(m)
ls()
remove(list = ls())
if(!require(pacman)){
install.packages("pacman")
library(pacman)
}
p_load(haven,stringr,dplyr,ggplot2,mediation)
setwd("../../Extracted Files/Data")
toload <- str_subset(list.files(),".dta")
data <- lapply(toload, read_dta)
fnl <- data[[1]]
set.seed(08540)
mediateout <- function(x){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
outform <- as.formula(paste(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
outcomes <- c("VoteShareNo",
"Share_reg70_w2",
"share_aylwin89",
"share_frei93",
"share_lagos99",
"share_bachelet05",
"share_frei09")
medmods <- list()
for(i in seq_along(medmods)){
medmods[[i]]<-mediateout(outcomes[i])
}
mediateout(outcomes[1])
mediateout <- function(x){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
outform <- as.formula(paste(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout(outcomes[1])
x <- outcomes[1]
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
outform <- as.formula(paste(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
mediateout("lol")
?mediateout
mediateout("VoteShareNo")
outcomes[1]
mediateout(outcomes[1])
outcomes <- c("VoteShareNo",
"Share_reg70_w2",
"share_aylwin89",
"share_frei93",
"share_lagos99",
"share_bachelet05",
"share_frei09")
medmods <- list()
for(i in seq_along(medmods)){
medmods[[i]]<-mediateout(outcomes[i])
}
mediateout(outcomes[1])
medmods <- list()
for(i in seq_along(medmods)){
medmods[[i]]<-mediateout(outcomes[i])
}
for(i in seq_along(outcomes)){
medmods[[i]]<-mediateout(outcomes[i])
}
warnings()
remove(list = ls())
if(!require(pacman)){
install.packages("pacman")
library(pacman)
}
p_load(haven,stringr,dplyr,ggplot2,mediation)
setwd("../../Extracted Files/Data")
toload <- str_subset(list.files(),".dta")
data <- lapply(toload, read_dta)
fnl <- data[[1]]
set.seed(08540)
mediateout <- function(x){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
outform <- as.formula(paste(paste(x, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
outcomes <- c("VoteShareNo",
"Share_reg70_w2",
"share_aylwin89",
"share_frei93",
"share_lagos99",
"share_bachelet05",
"share_frei09")
medmods <- list()
for(i in seq_along(outcomes)){
medmods[[i]]<-mediateout(outcomes[i])
}
mediateout <- function(outcome){
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
outform <- as.formula(paste(paste(outcome, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
outcomes <- c("VoteShareNo",
"Share_reg70_w2",
"share_aylwin89",
"share_frei93",
"share_lagos99",
"share_bachelet05",
"share_frei09")
medmods <- list()
for(i in seq_along(outcomes)){
medmods[[i]]<-mediateout(outcomes[i])
}
mediateout("VoteShareNo")
dat <- fnl %>% filter(MainSample==1,!is.na(shVictims_70),!is.na(DMilitaryPresence),!is.na(Pop70)) %>% mutate(IDProv = as.factor(IDProv))
dat<- bind_cols(dat,model.matrix( ~ IDProv - 1, data=dat))
mediateout <- function(outcome){
outform <- as.formula(paste(paste(outcome, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
medform <- as.formula(paste("shVictims_70 ~ DMilitaryPresence + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70",paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
mediateout <- function(outcome){
outform <- as.formula(paste(paste(outcome, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(outform,data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
makeform <- function(outcome){
outform <- as.formula(paste(paste(outcome, "~ DMilitaryPresence + shVictims_70 + share_allende70 +share_alessandri70+lnDistStgo+lnDistRegCapital+Pop70_pthousands+sh_rural_70"),paste0("IDProv",2:length(levels(dat$IDProv)),collapse = " + "),sep=" + "))
return(outform)
}
makeform("VoteShareNo")
mediateout <- function(outcome){
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(makeform(outcome=outcome),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mediateout("VoteShareNo")
mfun <- function(out){
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(makeform(outcome=out),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mfun("VoteShareNo")
mfun <- function(out=NULL){
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(makeform(outcome=out),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mfun("VoteShareNo")
mfun(out="VoteShareNo")
args(mfun)
mfun <- function(x){
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(makeform(outcome=out),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
args(mfun)
mfun
mfun <- function(x){
m1 <-  lm(medform,data=dat,weights = dat$Pop70)
m2 <-  lm(makeform(outcome=x),data=dat,weights = dat$Pop70)
m <- mediate(m1,m2,treat = 'DMilitaryPresence',mediator='shVictims_70',boot=T,sims=1000)
return(m)
}
mfun("VoteShareNo")
