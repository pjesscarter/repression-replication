if(!require(pacman)){
install.packages("pacman")
library(pacman)
}
p_load(haven,stringr,dplyr,ggplot2,sf,stargazer,rdrobust,randomForest)
setwd("../../Extracted Files/Data")
toload <- str_subset(list.files(),".dta")
data <- lapply(toload, read_dta)
shp <- read_sf("Map/cl_comunas_geo/Paper Replication/Data/Map/cl_comunas_geo.shp")
fnl <- data[[1]]
makeform <- function(treat,outcome){
#Edit to change baseline controls
controls <- c("share_allende70",
"share_alessandri70",
"lnDistStgo",
"lnDistRegCapital",
"Pop70_pthousands",
"sh_rural_70",
"IDProv")
f <- as.formula(
paste(outcome,
paste(c(treat,controls), collapse = " + "),
sep = " ~ "))
}
rf_out <- randomForest(makeform(DMilitaryPresence), data=fnl)
#Edit to change baseline controls
controls <- c("share_allende70",
"share_alessandri70",
"lnDistStgo",
"lnDistRegCapital",
"Pop70_pthousands",
"sh_rural_70",
"IDProv",extracontrols)
rf_out <- randomForest(makeform(DMilitaryPresence), data=fnl)
makeform <- function(outcome,extracontrols = NULL){
#Edit to change baseline controls
controls <- c("share_allende70",
"share_alessandri70",
"lnDistStgo",
"lnDistRegCapital",
"Pop70_pthousands",
"sh_rural_70",
"IDProv",extracontrols)
f <- as.formula(
paste(outcome,
paste(controls, collapse = " + "),
sep = " ~ "))
}
rf_out <- randomForest(makeform(DMilitaryPresence), data=fnl)
rf_out <- randomForest(makeform("DMilitaryPresence"), data=fnl)
fnl_rf %>% fnl %>% filter(!is.na(IDProv))
fnl_rf <- fnl %>% filter(!is.na(IDProv))
rf_out <- randomForest(makeform("DMilitaryPresence"),data= fnl_rf)
fnl_rf <- fnl %>% filter(!is.na(IDProv),!is.na(DMilitaryPresence))
rf_out <- randomForest(makeform("DMilitaryPresence"),data= fnl_rf)
fnl_rf <- fnl %>% filter(!is.na(IDProv),!is.na(share_allende70),!is.na(Pop70_pthousands))
rf_out <- randomForest(makeform("DMilitaryPresence"),data= fnl_rf)
?randomForest
rf_out <- randomForest(makeform("DMilitaryPresence"),data= fnl_rf,ntree=1000)
fnl_rf <- fnl %>% filter(!is.na(IDProv),!is.na(share_allende70),!is.na(Pop70_pthousands)) %>% mutate(DMilitaryPresence = as.factor(DMilitaryPresence), IDProv = as.factor(IDProv))
rf_out <- randomForest(makeform("DMilitaryPresence"),data= fnl_rf,ntree=1000)
rf_out$predicted
rf_out$votes
rf_out$votes[,2]
fnl_rf$propscore <- ps
ps <- rf_out$votes[,2]
fnl_rf$propscore <- ps
p_load(haven,stringr,dplyr,ggplot2,sf,stargazer,rdrobust,randomForest,Matching)
ggplot(fnl_rf,aes(x=ps,fill=DMilitaryPresence)) + geom_density(alpha=0.4)
?Match
#1:1 matching with replacement, using pop weights
matched <- Match(Y=fnl_rf$shVictims_70,
Tr=fnl_rf$DMilitaryPresence,
X=fnl_rf$propscore,
M=1)
fnl_rf_vict <- fnl_rf %>% filter(!is.na(shVictims_70))
#1:1 matching with replacement, using pop weights
matched <- Match(Y=fnl_rf_vict$shVictims_70,
Tr=fnl_rf_vict$DMilitaryPresence,
X=fnl_rf_vict$propscore,
M=1)
#1:1 matching with replacement, using pop weights
matched <- Match(Y=fnl_rf_vict$shVictims_70,
Tr=fnl_rf_vict$DMilitaryPresence ==1,
X=fnl_rf_vict$propscore,
M=1)
mb <- MatchBalance(makeform("DMilitaryPresence"),data=fnl_rf_vict,match.out = matched,nboots=1000)
fnl_rf_vict <- fnl_rf %>% filter(!is.na(shVictims_70)) %>% mutate(D = fnl_rf_vict$DMilitaryPresence ==1)
#1:1 matching with replacement, using pop weights
matched <- Match(Y=fnl_rf_vict$shVictims_70,
Tr=fnl_rf_vict$D,
X=fnl_rf_vict$propscore,
M=1)
mb <- MatchBalance(makeform("D"),data=fnl_rf_vict,match.out = matched,nboots=1000)
#1:1 matching with replacement, using pop weights
matched <- Match(Y=fnl_rf_vict$shVictims_70,
Tr=fnl_rf_vict$D,
X=fnl_rf_vict$propscore,
M=1,
weights = fnl_rf_vict$Pop70)
summary(matched)
