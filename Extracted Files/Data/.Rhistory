#Load packages for data exploration
if(!require(pacman)){
install.packages("pacman")
library(pacman)
}
p_load(haven,stringr,dplyr,ggplot2,sf,stargazer,rdrobust)
setwd("../../Extracted Files/Data")
toload <- str_subset(list.files(),".dta")
data <- lapply(toload, read_dta)
shp <- read_sf("Map/cl_comunas_geo/Paper Replication/Data/Map/cl_comunas_geo.shp")
fnl <- data[[1]]
cutoffs <- seq(2,20,0.1)
#Store point estimate along with robust SE and p-value, plus cutoff
store <- matrix(nrow = length(cutoffs),ncol=4)
for(i in seq_along(cutoffs)){
m <-tryCatch({rdrobust(y=fnl$Share_reg70_w2,x=fnl$dist,fuzzy = fnl$DVictims_p75,
deriv =0,
c=cutoffs[i],
p=1,
q=2,
kernel = "epanechnikov",
masspoints="adjust",
subset = !is.na(fnl$IDProv),
covs = cbind(fnl$share_allende70,
fnl$share_alessandri70,
fnl$lnDistStgo,
fnl$lnDistRegCapital,
fnl$Pop70_pthousands,
fnl$sh_rural_70))},
error = function(e) NA
)
if(!is.na(m)){
store[i,] <- c(m$coef[3],m$se[3],m$pv[3],cutoffs[i])
}
}
View(store)
rdrobust(y=fnl$Share_reg70_w2,x=fnl$dist,fuzzy = fnl$DVictims_p75,
deriv =0,
c=5,
p=1,
q=2,
kernel = "epanechnikov",
masspoints="adjust",
subset = !is.na(fnl$IDProv),
covs = cbind(fnl$share_allende70,
fnl$share_alessandri70,
fnl$lnDistStgo,
fnl$lnDistRegCapital,
fnl$Pop70_pthousands,
fnl$sh_rural_70))
fnl <- fnl %>% mutate(dist = exp(LnDistMilitaryBase),
cutoff2 = as.numeric(dist<2),
cutoff3 = as.numeric(dist<3),
cutoff4 = as.numeric(dist<4),
cutoff5 = as.numeric(dist<5),
cutoff10 = as.numeric(dist<10),
cutoff20 = as.numeric(dist<20),
IDProv = as.factor(IDProv)
)
#Store point estimate along with robust SE and p-value, plus cutoff
store <- matrix(nrow = length(cutoffs),ncol=4)
for(i in seq_along(cutoffs)){
m <-tryCatch({rdrobust(y=fnl$Share_reg70_w2,x=fnl$dist,fuzzy = fnl$DVictims_p75,
deriv =0,
c=cutoffs[i],
p=1,
q=2,
kernel = "epanechnikov",
masspoints="adjust",
subset = !is.na(fnl$IDProv),
covs = cbind(fnl$share_allende70,
fnl$share_alessandri70,
fnl$lnDistStgo,
fnl$lnDistRegCapital,
fnl$Pop70_pthousands,
fnl$sh_rural_70))},
error = function(e) NA
)
if(!is.na(m)){
store[i,] <- c(m$coef[3],m$se[3],m$pv[3],cutoffs[i])
}
}
View(store)
store[which(store[,3]<0.05),]
